---
title: "Trabalho6"
author: "Thiago Tavares Lopes"
date: "2025-06-27"
output: html_document
---

```{r include=FALSE}
library(tidyverse)
library(VGAM)
library(MASS)
library(kableExtra)
library(knitr)
library(scales)  # para percent_format
library(ggtext)  # para formatação se quiser melhorar labels (opcional)

```


```{r include=FALSE}





dados <- tribble(
  ~tabaco, ~cardiaco, ~Excelente, ~Bom, ~Moderado, ~Ruim,
  "Sim",   "Sim",         27,     76,     101,      39,
  "Sim",   "Não",        402,    1050,    522,     145,
  "Não",   "Sim",         83,    406,     442,     114,
  "Não",   "Não",       1959,   4521,    2243,     405
)

# Transformar em formato longo
dados_long <- dados |>
  pivot_longer(cols = Excelente:Ruim, names_to = "estado_saude", values_to = "freq") |>
  mutate(
    tabaco = factor(tabaco),
    cardiaco = factor(cardiaco),
    estado_saude = factor(estado_saude, levels = c("Excelente", "Bom", "Moderado", "Ruim"), ordered = TRUE)
  )


# Calcular proporções por grupo
dados_prob <- dados_long |>
  group_by(tabaco, cardiaco) |>
  mutate(proporcao = freq / sum(freq))
attach(dados_prob)

```

```{r, echo=FALSE}
dados1 <- dados |> 
  mutate(Total=rowSums(dados[,c(3:6)]))


dados1 |> 
  kbl() |> 
  kable_classic(full_width = F, html_font = "Cambria")




```




```{r, echo=FALSE}

# Gráfico de barras empilhadas

# ggplot(dados_prob, aes(x = interaction(tabaco, cardiaco), y = proporcao, fill = estado_saude)) +
#   geom_col() +
#   labs(x = "Tabaco x Problema Cardíaco", y = "Proporção", fill = "Estado de Saúde") +
#   theme_minimal()


```

```{r, echo=FALSE, warning=FALSE}

# Gráfico com valores e cores em tons pastel
ggplot(dados_prob, aes(x = interaction(tabaco, cardiaco), y = proporcao, fill = estado_saude)) +
  geom_col() +
  geom_text(aes(label = scales::percent(proporcao, accuracy = 1)),
            position = position_stack(vjust = 0.5), size = 4, color = "black") +
  scale_fill_brewer(palette = "Pastel1") +
  labs(x = "Tabaco x Problema Cardíaco", y = "Proporção", fill = "Estado de Saúde") +
  theme_minimal(base_size = 14)
```

```{r}
# Modelo chances não proporcionais
mcnp <- vglm(cbind(Excelente,Bom,Moderado,Ruim) ~ tabaco,
             cumulative(parallel=FALSE,reverse=FALSE), dados)

# Modelo de chances proporcionais
mcp <- vglm(cbind(Excelente,Bom,Moderado,Ruim) ~ tabaco,
            cumulative(parallel=TRUE,reverse=FALSE), dados) 

round(coef(mcnp, matrix = TRUE), digits = 3)
round(coef(mcp, matrix = TRUE), digits = 3)

# Comparação dos modelos
TRV <- 2*(logLik(mcnp) - logLik(mcp))
gl <- length(coef(mcnp)) - length(coef(mcp))
p <- 1-pchisq(TRV,gl)
cbind(TRV, gl, p)

lrtest(mcnp, mcp)

```

```{r}
# Modelos com somente CARDIACO

# Modelo chances não proporcionais
mcnp <- vglm(cbind(Excelente,Bom,Moderado,Ruim) ~ cardiaco,
             cumulative(parallel=FALSE,reverse=FALSE), dados)

# Modelo de chances proporcionais
mcp <- vglm(cbind(Excelente,Bom,Moderado,Ruim) ~ cardiaco,
            cumulative(parallel=TRUE,reverse=FALSE), dados) 

coef(mcnp, matrix = TRUE)
coef(mcp, matrix = TRUE)

# Comparação dos modelos
TRV <- 2*(logLik(mcnp) - logLik(mcp))
gl <- length(coef(mcnp)) - length(coef(mcp))
p <- 1-pchisq(TRV,gl)
cbind(TRV, gl, p)

lrtest(mcnp, mcp)
```


